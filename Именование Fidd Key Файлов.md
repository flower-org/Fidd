# Именование Fidd Key Файлов

Одной из важных операций в Fidd является операция получения Fidd Key подписчиком. 
Опишем, как она будет устроена.

## Требования

Здесь представляется важным следующее:
1. Отсутствие утечки любых, напрямую или косвенно идентифицирующих подписчика данных;
2. Возможность для подписчика быстро и удобно получить или идентифицировать свой ключ для сообщения из 
(потенциально большого) массива ключей подписчиков;
3. Невозможность корреляции файлов ключей из одного сообщения с файлами ключей из другого сообщения, или из другого Fidd-а;
4. Допускается возможность работы в ситуации публичного доступа ко всем файлам Fidd-а, но даже при этом все вышеуказанные 
свойства должны сохраняться.

Таким образом, даже в такой ситуации, когда файлы Fidd-а будут доступны для всеобщего обозрения, (например на блокчейне,
или на публичной папке сервера, или иного открытого для всех хостинга файлов), мы должны гарантировать, что будет 
крайне затруднительным понять, подписан ли конкретный подписчик на тот или иной Fidd, или имеет ли он доступ к
тому или иному сообщению. Более того, также должно быть невозможным определить, внутри одного и того же Fidd-а, 
меняется ли состав подписчиков от сообщения к сообщению, остается ли он одинаковым или же обновляется с каждым новым сообщением.

На базовом, сами публичные ключи подписчиков нигде не должны фигурировать в открытом виде, их должно быть невозможно выяснить
из опубликованной структуры Fidd-а, т.е. они будут являться секретом паблишера и не будут доступны из Fidd. 
Fidd Key файлы для разных сообщений для одного и того же подписчика должны иметь разные имена, и их должно быть 
невозможно скоррелировать между собой.
Это должно соблюдаться как внутри одного Fidd, так и across Fidds.

Для каждого Fidd-сообщения подписчик должен иметь возможность быстро и удобно найти Fidd Key-кандидаты, или же 
определить их отсутствие, ориентируясь лишь на названия файлов, без необходимости пытаться скачать и открыть все доступные 
Fidd Key файлы.


## Реализация

Для того, чтобы узнать наименование своего Fidd Key файла, подписчику необходимо вычислить электронную подпись, используя
свой публичный ключ. Подписать следует конкатенацию (Message Number + Message File Size).
Далее, полученную электронную подпись следует преобразовать в строку при помощи алгоритма Base36. т.о. данную строку можно 
будет использовать для формирования имени файла.
Идеально было бы здесь задействовать еще и публичный ключ паблишера, но на данном этапе не до конца понятно, будет ли 
этот ключ обязательным, или уникальным, или же будет ли он константным, к тому же теоретически мы не исключаем более чем 1го паблишера, 
поэтому видится нежелательным premature-но ограничивать гибкость и возможности расширения.

Отметим очевидный факт, что в данной схеме коллизии по подписям произойдут, если в разных Fidd-ах сообщения с одним и тем же 
номером будут иметь одинаковый размер, что довольно-таки маловероятно; а в контесте же одного и того же Fidd-а этого не должно
произойти никогда.

Т.к. перекодированные подписи - это довольно длинные строки, а также потому что мы хотим сделать как можно меньше информации 
доступной несанкционированным наблюдателям, имеет смысл скомпактировать / минимизировать размер имен Fidd Key файлов. 
Заметим, что в большинстве случаев подписчиков будет немного, а подписи их буду разниться существенно.
Для компакции на этапе паблишинга определим минимальный префикс для каждого подписчика, который будет являться 
уникальным среди всех подписчиков.
Таким образом, использовав не всю подпись, а только уникальный префикс в качестве имени Fidd Key файла мы не только уменьшим
размер этих имен, но и скроем большую часть информации о подписи, еще сильнее затруднив корреляцию подписчиков между Fidd-ами.

Данное наблюдение позволяет нам неформально назвать данную систему "достаточно защищенной", т.е. даже при условии 
одинаковых (Message Number + Message File Size), скоррелировать что-то будет крайне затруднительно.
Действительно, ведь даже при получении атакующим публичного ключа подписчика (что несложно, если подписчик 
использует тот же ключ для подписки на некие злонамеренные Fidd-ы), для подтверждения факта его подписки на другие Fidd-ы
нужно иметь возможность расшифровать заматченные Fidd Key файлы, что невозможно сделать без приватного ключа. 
А без этого невозможно утверждать, какой конкретно парой ключей Fidd Key файлы были зашифрованы - т.к. компакция имен 
Fidd Key файлов создает достаточно существенные коллизии.  
Так, для десятка подписчиков они будут иметь по 2-3 символа, в то время
как полный размер подписи будет измеряться в тысячах символов, и для уверенного матчинга у атакующего навряд ли хватит информации.